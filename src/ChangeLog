1998-08-01  Bruno Haible  <haible@ilog.fr>

        * aclocal.m4 (CL_RUSAGE): Prefer RUSAGE_WHO_T="int" to
          RUSAGE_WHO_T="enum __rusage_who".

1998-08-01  Bruno Haible  <haible@ilog.fr>

       * makemake.in (DEEMA): Add _EMA_ in more places.

1998-08-01  Bruno Haible  <haible@ilog.fr>

        * lispbibl.d: Accept __unix__ as an alternative for __unix.

1998-08-01  Bruno Haible  <haible@ilog.fr>

        * clx/mit-clx/package.lsp: Shadow BOOLEAN and don't export it.

1998-07-31  Bruno Haible  <haible@ilog.fr>

        * control.d (make_variable_frame): Don't call Car(NIL).

1998-07-16  Sam Steingold  <sds@goems.com>
 
        * spvw.d, constsym.d: new symbol print_right_margin
          (ANSI CL's *print-right-margin*).
        * io.d (right_margin): New function.
          (klammer_zu, justify_end_eng, justify_end_weit): Use it.
          (pr_level): Turn into a macro.
          (write, write_to_string): added :right-margin.
        * subr.d (write, write_to_string): added :right-margin.
        * subrkw.d (write, write_to_string): added :right-margin.
        * constobj.d (version): bumped to 19980715.
        * compiler.lsp (subr-info): added :right-margin to write and
          write_to_string;
          (c-eval-when-compile, compile-toplevel-form, finalize-coutput-file):
          added `:right-margin 79' to the `write' calls.

1998-07-16  Bruno Haible  <bruno@linuix.math.u-bordeaux.fr>

        * eval.d (get_closure): Don't call augment_decl_env with argument NIL.

1998-06-29  Sam Steingold  <sds@usa.net>

        * compiler.lsp (compile-file): in ANSI CL, compile-file is
          required to return 3 values.

1998-06-25  Bruno Haible  <bruno@linuix.math.u-bordeaux.fr>

        * lispbibl.d: Define NO_TYPECODES by default for 32-bit machines.
        * configure: Don't pass option --with-wide to makemake.
        * makemake.in: Drop support for --with-wide.
        * clisp-link.in: Likewise.
        * _distmakefile: Likewise.
        * regexp/link.sh, regexp/Makefile.in: Likewise.
        * wildcard/link.sh, wildcard/Makefile.in: Likewise.
        * queens/link.sh, queens/Makefile: Likewise.
        * linuxlibc5/link.sh, linuxlibc5/Makefile: Likewise.
        * linuxlibc6/link.sh, linuxlibc6/Makefile: Likewise.
        * clx/mit-clx/link.sh, clx/mit-clx/Makefile.clisp: Likewise.
        * clx/new-clx/link.sh, clx/new-clx/Makefile: Likewise.
        * doc/module.txt, impnotes.html: Update.
        * _clisp.c: Ignore option -W.

1998-06-25  Bruno Haible  <bruno@linuix.math.u-bordeaux.fr>

        * stream.d (finish_output_file): Fix typo.
        * makemake.in: For Win32, replace
          "-I../ffcall/avcall -I../ffcall/callback" with "-I../callback".
          For Unix, remove "-Iavcall -Icallback".
        * win32msvc/INSTALL: Simplify instructions.

1998-06-25  Bruno Haible  <bruno@linuix.math.u-bordeaux.fr>

        In the NO_TYPECODES model, add support for machine where the alignment
        of C functions is less than 4.
        * lispbibl.d (C_CODE_ALIGNMENT, log2_C_CODE_ALIGNMENT): New macros.
          (NO_TYPECODES): Remove CPU constraint.
          (make_machine_code): New macro.
          (TheMachineCode): New macro.
          (ThePseudofun): Use it.
        * spvw.d (verify_code_alignment): New macro.
          (fehler_code_alignment): New function.
          (init_symbol_functions): Call verify_code_alignment.
        * list.d (sublis_assoc): Use TheMachineCode instead of TheMachine.
          (SUBLIS, NSUBLIS): Use make_machine_code instead of make_machine.
        * stream.d (P): Likewise.

1998-06-25  Bruno Haible  <bruno@linuix.math.u-bordeaux.fr>

        * lispbibl.d (Fsubr): Move the C code address from the recdata[] part
          to the non-Lisp-object part.
          (fsubr_length): Reduce by 1.
          (fsubr_xlength): Define.
          (allocate_fsubr): Update accordingly.
        * misc.d (SYS::CODE-ADDRESS-OF): Drop TheMachine on fsubr->function.
        * eval.d (eval_fsubr): Likewise.
        * spvw.d (do_aktualisiere_record): If aktualisiere_fsubr_function is
          TRUE and the object is an Fsubr, call the aktualisiere_fs_function
          macro.
          (gar_col_normal): No need for aktualisiere_fsubr_function here.
          (gar_col_compact): Likewise.
          (move_conses): Likewise.
          (init_symbol_functions): Drop make_machine for fsubr->function.
          (memdump_reloc_header): Add support for relocation Fsubr code
          addresses.
          (savemem): Likewise.
          (loadmem_aktualisiere): Don't look in old_fsubr_tab when updating
          a machine pointer.
          (loadmem_aktualisiere_fsubr): New function.
          (loadmem_from_handle): During aktualisiere_varobjects or during
          fast relocation phase, call loadmem_aktualisiere_fsubr.

1998-06-24  Bruno Haible  <bruno@linuix.math.u-bordeaux.fr>

        * spvw.d (make_ratio): Compute positivep(num) before doing the
          memory allocation.
        * comptran.d (R_R_atanh_R_R): Do not call R_minusp on a non-GC-safe
          object.
        * flo_rest.d (F_integer_decode_float_I_I_I): Likewise.

1998-06-20  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>

        * arilev1c.d (eqv_loop_up, nand_loop_up): Fix typo in declaration.

1998-06-20  Gilbert Baumann  <unk6@rz.uni-karlsruhe.de>
 
        * io.d (SYS::REAL-LISTEN): New function.

1998-06-15  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>

        * lispbibl.d: Remove the last vestiges of STDWIN.
        * configure: Likewise.
        * clx/new-clx/clx.f, clx/new-clx/e2d.c: Likewise.

1998-06-10  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* io.d (pr_enter_1, pr_enter_2, pr_enter): New functions, generalizing
	  prin1a, prin1b, prin1.
	  (pr_external_1, pr_external_2): Moved.
	  (pr_instance): Moved.
	  (pr_structure_default): New function.
	  (SYS::PRINT-STRUCTURE): Call it through pr_enter.
	  (prin1a, prin1b): Remove functions.
	  (prin1): Use pr_enter.

1998-07-08  Sam Steingold  <sds@goems.com>
 
        * array.d: fixed the grammar of some English messages.
	
1998-05-31  Pierpaolo Bernardi  <bernardp@cli.di.unipi.it>
	
	* macros2.lsp (with-output-to-string): The STRING parameter
	  now accept NIL as value (with the same meaning as if it were 
	  unsupplied). {Old|New} behavior {was CLtL1|is ANSI} compliant.
	
1998-05-25  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* lispbibl.d: Rename immediate_type_p to gcinvariant_type_p.
	* spvw.d: Update.
	
1998-05-24  Pierpaolo Bernardi  <bernardp@cli.di.unipi.it>
	
	* macros1.lsp (do/do*-expand): Barf on bad syntax.

1998-05-20  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>

        * dbxtypes.d: Remove file.
        * makemake.in: Update.
        * gettext/po/Makefile.devel (DSOURCES): Update.

1998-05-20  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>

        * windows.d, wintext.d, winstat.d, winmain.d, winaux.d: Remove files.
        * lispbibl.d, genclisph.d, msdos.d, makemake.in, spvw.d, pathname.d,
          stream.d, pseudofun.d, time.d: Remove support for Windows 3.1.
	
1998-05-20  Sam Steingold  <sds@usa.net>
	
	* io.d (pr_orecord): print PATHNAME with #P syntax, as
	  per ANSI CL <PRINT-READABLY-BEHAVIOR:CLARIFY>;
	
1998-05-19  Sam Steingold  <sds@usa.net>
	
	Implement the new :execute, :load-toplevel and :compile-toplevel
	keywords for eval-when as synonyms for eval, load and compile
	respectively.  The symantics is old.	
	* constsym.d: add :execute, :load-toplevel and :compile-toplevel
	  keywords.
	* control.d (eval_when): handle :execute and :compile-toplevel.
	* init.lsp (%expand-form, (%put '%expand 'EVAL-WHEN)): handle
	  :compile-toplevel. 
	* compiler.lsp (c-EVAL-WHEN): handle the three new keywords as
	  synonyms to the old symbols.
	
1998-05-18  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* control.d (SPECIAL-OPERATOR-P): Renamed from SPECIAL-FORM-P.
	* eval.d (FUNTAB): Update.
	* compiler.lsp (funtab, subr-info): Update.
	  (c-form-table, c-form, c-DIRECT-FUNCTION-CALL,
	  inline-callable-function-p, c-APPLY): Use SPECIAL-OPERATOR-P.
	  (note-function-used): Generate a warning for SPECIAL-FORM-P.
	* init.lsp: Export both SPECIAL-OPERATOR-P and SPECIAL-FORM-P.
	  (remove-old-definitions, %expand-form, defun): Use
	  SPECIAL-OPERATOR-P.
	* defs1.lsp (special-form-p): Define as an alias for
	  special-operator-p.
	* user2.lsp (fbound-string, describe): Use SPECIAL-OPERATOR-P.
	* trace.lsp (trace1): Use SPECIAL-OPERATOR-P.
	* defs3.lsp: Export SPECIAL-OPERATOR-P only.
	
1998-05-17  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* genclisph.d (main): Define sintB.
	
1998-05-16  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* clx/new-clx/clx.f: Update to use the new macro names.
	
	* realtran.d (R_cos_sin_R_R): Shift a fixnum by oint_data_shift, not
	  oint_addr_shift.
	
	New type encoding scheme NO_TYPECODES.
	* lispbibl.d (TYPECODES): Define if NO_TYPECODES is not defined.
	  (oint_type_*, oint_addr_*, oint_data_*): Provide alternative
	  definitions for no TYPECODES.
	  (machine_bias, subr_bias, varobject_bias, cons_bias, immediate_bias,
	  nonimmediate_bias_mask, read_label_type, immediate_object_p,
	  gcinvariant_object_p): New macros.
	  (fixnum_type, sfloat_type, char_type, system_type, sign_bit_o,
	  bignum_bit_o, type_data_object, type_zero_oint, garcol_bit_o):
	  Provide alternative definitions.
	  (varobject_alignment): Must be at least 4 if no TYPECODES.
	  (active_bit, dynam_bit, svar_bit, NO_symbolflags): Define if no
	  TYPECODES.
	  (constant_bit_f, special_bit_f, keyword_bit_f): New macros.
	  (SPVW_MIXED): Define if no TYPECODES.
	  (case_mut_*): New macros.
	  (_case_structure, _case_stream): Provide alternative definitions.
	  (intWCsize, uintWC, sintWC): Provide alternative definitions.
	  (VAROBJECT_HEADER, header_flags, constant_bit_hf, special_bit_hf,
	  keyword_bit_hf): Provide alternative definitions.
	  (varobject_type, lrecord_tfl, srecord_tfl, xrecord_tfl): New macros.
	  (record_, record_type, record_flags, record_flags_*): Provide
	  alternative definitions.
	  (LRECORD_HEADER, lrecord_, Lrecord, lrecord_length): New definitions.
	  (SRECORD_HEADER, srecord_length, XRECORD_HEADER, xrecord_length,
	  xrecord_xlength): Provide alternative definitions.
	  (Rectype_Sbvector, Rectype_Sstring, Rectype_Svector, Rectype_mdarray,
	  Rectype_bvector, Rectype_string, Rectype_vector, Rectype_Bignum,
	  Rectype_Lfloat, Rectype_Dfloat, Rectype_Ffloat, Rectype_Symbol): New
	  enum values.
	  (char_int, bignum_, bignum_length, lfloat_, lfloat_length): Provide
	  alternative definitions.
	  (sarray_, sbvector_, sstring_, svector_): Use LRECORD_HEADER.
	  (sarray_length): Use lrecord_length.
	  (iarray_, iarray_rank, iarray_flags, iarray_flags_*, Array_type,
	  Array_type_*): Provide alternative definitions.
	  (Codevec): Use LRECORD_HEADER.
	  (make_read_label, read_label_integer_p, make_machine, The*): Provide
	  alternative definitions.
	  (consp, mconsp, atomp, matomp): Provide alternative definitions.
	  (varobjectp, immediate_number_p): New macros.
	  (symbolp, numberp, vectorp, simplep, array_simplep, simple_vector_p,
	  general_vector_p, simple_string_p, stringp, simple_bit_vector_p,
	  bit_vector_p, byte_vector_p, general_byte_vector_p, arrayp,
	  mdarrayp, if_recordp, closurep, instancep, orecordp, charp, subrp,
	  framepointerp): Provide alternative definitions.
	  (machinep, read_label_p, systemp): New macros.
	  (if_realp, if_rationalp, integerp, fixnump, posfixnump, bignump):
	  Provide alternative definitions.
	  (posbignump): New macro.
	  (ratiop, floatp, short_float_p, single_float_p, double_float_p,
	  long_float_p, complexp, positivep): Provide alternative definitions.
	  (case_Rectype_*_above): New macros.
	  (R_sign): Provide alternative definition.
	  (FN_sign, BN_sign, RT_sign, SF_sign, FF_sign, DF_sign, LF_sign): New
	  macros.
	  (same_sign_p, N_floatp, N_integerp, R_rationalp, R_floatp, R_minusp,
	  RA_integerp, RA_ratiop, I_bignump, I_fixnump): Provide alternative
	  definitions.
	  (FN_positivep, BN_positivep, I_I_bignums_p): New macros.
	  (sint8_p, sint16_p, uint32_p, sint32_p, uint64_p, sint64_p): Use
	  the new macros.
	  (allocate_srecord, allocate_xrecord, subr_tab_ptr_as_object,
	  S_help_): Provide alternative definitions.
	  (FB7..FB1, make_framepointer, topofframe, uTheFramepointer,
	  framecode, fcint): Provide alternative definitions.
	  (framebottomword): Add third argument.
	  (framebottomword, finish_frame): Provide alternative definitions.
	  (SAVE_REGISTERS, dynamic_bind): Use finish_frame.
	  (finish_entry_frame): Update.
	* genclisph.d: Update.
	  (SP): Move the asm string outside of the printf string.
	* spvw.d (symbol_tab_ptr_as_object): Provide alternative definition.
	  (mem): heapnr_from_type only if TYPECODES.
	  (size_ffloat, size_dfloat): Provide alternative definitions.
	  (speicher_laenge): Provide alternative type dispatch.
	  (varobject_bytelength): Use TheVarobject instead of pointable.
	  (in_old_generation): Fix parenthesizing inside macro.
	  (gc_mark): Rewrite using macros. Provide alternative type dispatch.
	  (pointer_as_object, pointer_was_object): Provide alternative
	  definitions.
	  (walk_area_iarray): Renamed from walk_area_array.
	  (walk_area): Provide alternative definition.
	  (alive): Provide alternative type dispatch.
	  (gc_morris2, gc_morris3): Provide alternative body.
	  (set_GCself): Provide alternative definition.
	  (gc_sweep1_varobject_page): Some modifications if no TYPECODES.
	  (aktualisiere, aktualisiere_varobject): Provide alternative
	  definitions.
	  (build_old_generation_cache): Provide alternative type dispatch.
	  (build_old_generation_cache:cache_at): Provide alternative
	  definition.
	  (gar_col_normal): Remove unused variable.
	  (gc_compact_from_varobject_page): Some modifications if no TYPECODES.
	  (move_conses:aktualisiere): Provide alternative definition.
	  (pointable_usable_test): Always TRUE if no TYPECODES.
	  (bias_type_pointer_object): New macro.
	  (allocate_TRUE, allocate_FALSE): Use it.
	  (allocate_symbol, allocate_vector, allocate_bit_vector,
	  allocate_string, allocate_iarray): Provide alternative body.
	  (allocate_srecord_, allocate_xrecord_): Provide alternative
	  definitions.
	  (allocate_bignum, allocate_ffloat, allocate_dfloat, allocate_lfloat,
	  make_ratio, make_complex): Provide alternative body.
	  (get_circ_mark, get_circ_unmark, subst, subst_circ_mark,
	  subst_circ_unmark): Provide alternative type dispatch.
	  (map_heap_objects:varobject_typecode_at,cons_typecode_at,
	  with_typecode): Provide alternative definitions.
	  (init_symbol_tab_1): Some modifications if no TYPECODES.
	  (main): Initialize mem.heapnr_from_type only if TYPECODES.
	  (main): If no TYPECODES, use only a 2^(oint_addr_len-1) address
	  range.
	  (memflags): Include the settings of WIDE and TYPECODES.
	  (memdump_header, savemem): No _cons_type etc. if no TYPECODES.
	  (addr_mask, offset_pages_len): Fix for oint_addr_len==32.
	  (loadmem_aktualisiere): Provide alternative type dispatch.
	  (loadmem_from_handle): No _cons_type etc. if no TYPECODES.
	  Provide alternative for old_symbol_tab_o.
	* eval.d (eval1): Provide alternative type dispatch.
	* control.d (CONSTANTP): Provide alternative type dispatch.
	* stream.d (P): Provide alternative definition.
	* io.d (prin_object_dispatch, pr_orecord): Provide alternative type
	  dispatch.
	  (pr_readlabel): Some modifications if no TYPECODES.
	* array.d (bit_up, test_displaced): Modify type dispatch.
	* hashtabl.d (hashcode2, hashcode3_atom, hashcode4_atom, sxhash_atom):
	  Provide alternative type dispatch.
	* charstrg.d (coerce_ss): Provide alternative type dispatch.
	* predtype.d (eql, equal, equalp, COMMONP, TYPE-OF, CLOS:CLASS-OF,
	  heap_statistics_mapper): Provide alternative type dispatch.
	* aridecl.d: Use sign_bit_o instead of vorz_bit_o if it applies to
	  fixnums or sfloats only.
	* intelem.d (I_to_UL, I_to_L, I_to_UQ, I_to_Q): Provide alternative
	  type dispatch. Use FN_sign, BN_sign where possible.
	  Use sign_bit_o instead of vorz_bit_o if it applies to fixnums only.
	* intlog.d (I_to_DS_n_): Use FN_sign.
	* intplus.d (I_I_plus_I, I_minus_I, I_I_minus_I): Use FN_sign.
	* intmal.d (I_I_mal_I): Use FN_sign.
	* sfloat.d (SF_decode): Use SF_sign.
	  (RA_to_SF): Use RT_sign.
	* ffloat.d (RA_to_FF): Likewise.
	* dfloat.d (RA_to_DF): Likewise.
	* lfloat.d (LF_decode, LF_ftruncate_LF, LF_futruncate_LF,
	  LF_fround_LF, LF_minus_LF, LF_shorten_LF, LF_extend_LF,
	  LF_LF_plus_LF, LF_LF_minus_LF, LF_LF_mal_LF, LF_LF_durch_LF):
	  Use LF_sign. Twiddle sign bit only if SPVW_MIXED && TYPECODES.
	  (RA_to_LF): Use RT_sign.
	* flo_konv.d: Use sign_bit_o instead of vorz_bit_o if it applies to
	  fixnums or sfloats only.
	* flo_rest.d (floatcase): Provide alternative definition.
	  (LF_I_scale_float_LF): Provide alternative type dispatch.
	  Use LF_sign.
	  (F_float_sign_F): Use SF_sign, FF_sign, DF_sign, LF_sign.
	* realelem.d (I_I_gleich): Use I_I_bignums_p.
	  (R_signum_R): Use LF_sign.
	* constsym.d (LISPSYM_B): Provide alternative definition.
	* affi.d (affi_call_argsa, SYS::NZERO-POINTER-P): Provide alternative
	  type dispatch.
	
1998-05-12  Sam Steingold  <sds@usa.net>
	
	* format.lsp (format-parse-cs, formatter-main-1): handle the ~//
	  format directive;
	  (format-slash, format-get-symbol): new functions that do the job.
	
1998-05-11  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* stream.d (SOCKET-SERVER, SOCKET-STREAM-PEERNAME): Remove unused
	  variables.
	
1998-05-10  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* lispbibl.d (iarray_rank, Iarray_rank, iarray_flags, Iarray_flags,
	  iarray_flags_*): New macros.
	* lispbibl.d, genclisph.d, spvw.d, io.d, stream.d, array.d,
	  hashtabl.d, sequence.d, charstrg.d, predtype.d, foreign.d, affi.d:
	  Update.
	
	* lispbibl.d (Array_type, Array_type_*): New macros.
	* io.d, array.d, predtype.d: Update.
	
	* lispbibl.d (oint_symbolflags_shift #ifdef NO_symbolflags): Define
	  as oint_data_shift, not oint_addr_shift.
	* spvw.d (gc_markphase, aktualisiere_STACK): Conditionalize more
	  code #ifndef NO_symbolflags.
	* debug.d (print_stackitem): Likewise.
	
	* spvw.d (memdump_header): Put _memflags right after _magic.
	  (savemem, loadmem_from_handle): Update.
	
	* spvw.d (pointer_as_object, pointer_was_object): New macros.
	  (gc_compact_cons_page, gc_sweep1_varobject_page, aktualisiere,
	  gc_sweep2_varobject_page, aktualisiere_page,
	  gc_compact_from_varobject_page, gc_compact_from_cons_page): Use them.
	
	* lispbibl.d (make_read_label, read_label_integer_p): New macros.
	  (framepointerp): New macro, renamed from stack_env_p.
	  (systemp): Remove macro.
	* eval.d, control.d, io.d, debug.d: Update.
	
	* eval.d (apply, funcall): Use abstract type test macros, and
	  improve the generated code a little bit.
	
	* lispbibl.d (record_type, Record_type, record_flags, Record_flags,
	  record_flags_*, srecord_length, Srecord_length, xrecord_length,
	  xrecord_xlength, Xrecord_length, Xrecord_xlength): New macros.
	* lispbibl.d, genclisph.d, spvw.d, eval.d, io.d, stream.d,
	  hashtabl.d, record.d, predtype.d, foreign.d, affi.d: Update.
	
	* spvw.d (do_aktualisiere_symbol, do_aktualisiere_svector,
	  do_aktualisiere_iarray, do_aktualisiere_record): New macros.
	  (aktualisiere_*): Use them.
	  (aktualisiere_iarray): Renamed from aktualisiere_array.
	
1998-05-09  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* stream.d (fehler_terminal_raw): Define function only when needed.
	
	* io.d (pr_readlabel, pr_framepointer): New functions, split out from
	  pr_system.
	  (pr_system): Much smaller.
	  (prin_object_dispatch): Distinguish system/read-label/framepointer
	  here.
	
	* lispbibl.d (framecode): New macro.
	* lispbibl.d, spvw.d, eval.d, control.d, eval.d: Use it.
	
	* lispbibl.d (fcint): New type.
	* eval.d: Use it.
	
	* lispbibl.d (msymbolp, mnumberp, mvectorp, m_simple_vector_p,
	  m_general_vector_p, m_simple_string_p, mstringp,
	  m_simple_bit_vector_p, m_bit_vector_p, marray1p, if_mrecordp,
	  mclosurep, minstancep, mstructurep, mstreamp, morecordp, mcharp,
	  msubrp, mintegerp, mfixnump, mposfixnump, mbignump, mratiop,
	  mfloatp, m_short_float_p, m_single_float_p, m_double_float_p,
	  m_long_float_p, mcomplexp, mpositivep, N_mfloatp, N_mintegerp,
	  R_mrationalp, R_mfloatp, R_mminusp, RA_mintegerp, RA_mratiop,
	  I_mbignump, I_mfixnump, N_mrealp, N_mcomplexp): Remove macros.
	* genclisph.d: Likewise.
	* spvw.d, eval.d, pathname.d, stream.d, io.d, array.d, hashtabl.d,
	  list.d, package.d, record.d, sequence.d, charstrg.d, debug.d,
	  error.d, misc.d, predtype.d, symbol.d, rexx.d, foreign.d,
	  intdiv.d, realelem.d, realtran.d, compelem.d, comptran.d: Update.
	
	* lispbibl.d (if_vectorp, if_simplep): Remove macros.
	* array.d, predtype.d: Update.
	
	* lispbibl.d: Document that any of the type test macros can cause
	  multiple evaluation of their argument.
	* predtype.d: Don't do type tests directly on popSTACK().
	
	* lispbibl.d (allocate_closure, allocate_cclosure_copy): New macros.
	* eval.d (get_closure, interpret_bytecode_): Use them.
	* io.d (GET-MACRO-CHARACTER): Use them.
	* record.d (SYS::%MAKE-CLOSURE,
	  SYS::GENERIC-FUNCTION-EFFECTIVE-METHOD-FUNCTION): Use them.
	
	* spvw.d (walk_area_cons, walk_area_symbol, walk_area_array,
	  walk_area_svector, walk_area_svector): New macros.
	  (walk_area): Simplify, use them.
	
	* lispbibl.d (byte_vector_p, general_byte_vector_p): New macros.
	* genclisph.d: Likewise.
	* stream.d (test_n_bytes_args): Use them.
	* sequence.d (get_seq_type): Likewise.
	* affi.d (SYS::MEM-READ, SYS::MEM-WRITE): Likewise.
	* predtype.d (equalp): Likewise.
	* foreign.d (convert_to_foreign): Likewise.
	
	* lispbibl.d (mdarray_type): Renamed from array_type.
	  (case_mdarray): Renamed from case_array1.
	  (Iarray): Renamed from Array.
	  (TheIarray): Renamed from TheArray.
	  (mdarrayp): Renamed from array1p.
	  (allocate_iarray): Renamed from allocate_array.
	  (iarray_displace_check): Renamed from array1_displace_check.
	* genclisph.d, spvw.d, stream.d, io.d, array.d, hashtabl.d, sequence.d,
	  charstrg.d, predtype.d, foreign.d, affi.d: Update.
	
	* lispbibl.d: Replace documentation of type encoding by new one.
	
	* lispbibl.d: Move the code defining SPVW_* before the definition of
	  the case_* macros.
	
	* lispbibl.d (uintWC, sintWC): New types, used for bignum length,
	  lfloat length, iarray rank.
	  (uintWCoverflow): New macro, replaces uintCoverflow.
	  (arrayrank_limit_1): Change value.
	* intelem.d (NUDS_to_I, UDS_to_I): Lengths fit in an uintWC, not uintC.
	* intlog.d (I_I_ash_I, I_logcount_I, I_integer_length,
	  I_integer_length_I): Likewise.
	* intplus.d (DS_1_plus, DS_minus1_plus, I_I_plus_I, I_I_minus_I):
	  Likewise.
	* intmal.d (UDS_UDS_mal_UDS): Likewise.
	* lfloat.d (LF_LF_durch_LF, LF_sqrt_LF, LF_to_I, I_to_LF, RA_to_LF):
	  Likewise.
	* flo_rest.d (lf_len_extend, F_float_digits_I, F_float_precision_I,
	  F_integer_decode_float_I_I_I): Likewise.
	* realtran.d (pi_F_float_F, lf_len_extend2): Likewise.
	* realrand.d (I_random_I): Likewise.
	* intread.d (DIGITS_to_I): Likewise.
	* lisparit.d (mal_10_plus_x, FLOAT-DIGITS, SYS::%SET-LONG-FLOAT-DIGITS,
	  log_digits): Likewise.
	* pathname.d (OPEN): Likewise.
	
	* constsym.d: Remove LISPSYM_B. Rename LISPSYM_C to LISPSYM_B.
	  Rename LISPSYM_D to LISPSYM_C. Rename LISPSYM_E to LISPSYM_D.
	* spvwtabs.d (symbol_tab_data): Update.
	* spvw.d (init_symbol_tab_2): Update.
	
	* lispbibl.d: Reorganize declarations of Cons, Ratio, Complex.
	  (Rectype_*): Now enum values.
	  (rectype_limit): New enum value.
	  (Record_length): Use rectype_limit.
	* spvw.d (speicher_laenge, speicher_laenge_record): Use rectype_limit.
	  (walk_area_record, aktualisiere_varobject): Likewise.
	  (build_old_generation_cache, allocate_srecord_, allocate_xrecord_):
	  Likewise.
	* predtype.d (equalp): Likewise.
	  (COMMONP): Put #if around "case Rectype_*".
	
	* spvw.d (gc_mark): Start macroizing this function.
	
	If SPVW_MIXED, put Ratio and Complex among the Varobjects.
	* lispbibl.d (_case_ratio, _case_complex): New macros (ugly).
	  (case_pair): New macro.
	  (Rectype_Ratio, Rectype_Complex): New enum values.
	  (ratio_, complex_): Conditionally add a XRECORD_HEADER.
	* genclisph.d: Update.
	* spvw.d (MM_TYPECASES): Update.
	  (gc_mark, walk_area, alive, gc_morris2, gc_morris3): Use case_pair.
	  (aktualisiere, main, loadmem_aktualisiere): Likewise.
	  (make_ratio, make_complex): Implement if SPVW_MIXED.
	  (subst, subst_circ_mark, subst_circ_unmark): Don't use case_record.
	* predtype.d (enum_hs_ratio, enum_hs_complex): Now unconditional.
	  (heap_statistics_mapper): Update.
	* constobj.d: Update.
	
	* lispbibl.d (make_machine): New macro.
	  (nullobj): Use it.
	* genclisph.d, spvw.d, list.d: Update.
	
	* lispbibl.d (bignum_length, Bignum_length): New macros.
	* lispbibl.d, genclisph.d, spvw.d, stream.d, hashtabl.d, predtype.d,
	  intelem.d, intlog.d, intcomp.d, intplus.d, flo_rest.d, realelem.d,
	  realtran.d: Update.
	
	* lispbibl.d (lfloat_length, Lfloat_length): New macros.
	* spvw.d, predtype.d, lfloat.d, flo_rest.d, realelem.d, realtran.d,
	  compelem.d, lisparit.d: Update.
	
	* lispbibl.d (sarray_length, Sarray_length): New macros.
	* lispbibl.d, array.d: Update.
	
	* lispbibl.d (sbvector_length, Sbvector_length): New macros.
	* spvw.d, io.d, array.d, record.d: Update.
	
	* lispbibl.d (sstring_length, Sstring_length): New macros.
	* spvw.d, io.d, pathname.d, stream.d, array.d, charstrg.d, rexx.d:
	  Update.
	
	* lispbibl.d (svector_length, Svector_length): New macros.
	* spvw.d, eval.d, control.d, io.d, array.d, hashtabl.d, package.d,
	  debug.d, error.d, predtype.d, rexx.d, foreign.d, affi.d: Update.
	
1998-05-09  Pierpaolo Bernardi  <bernardp@cli.di.unipi.it>
	
	* user1.lsp: move *PROMPT-WITH-PACKAGE* from SYS to LISP, 
	  and export it
	
1998-05-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* ffcall: Add support for DEC Alpha running Linux (libc6): Change all
	  ".rdata" in assembler output to ".data".
	
1998-05-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* socket.d: Don't declare connect() when using glibc2.
	* aclocal.m4 (CL_TCPCONN): Allow setsockopt to be declared with
	  socklen_t = unsigned int.
	
1998-05-08  Sam Steingold  <sds@usa.net>
	
	* constsym.d (*floating-point-contagion-ansi*): New variable.
	* constobj.d (fpcontagion_warn_string): Change wording.
	* flo_rest.d (warn_floating_point_contagion): Change appropriately.
	  (GEN_F_op2, GEN_LF_op2_0): Implement ANSI compliant float contagion.
	* realelem.d (R_R_contagion_R): Likewise.
	* lisparit.d (init_arith): Initialize *floating-point-contagion-ansi*.
	
1998-05-08  Pierpaolo Bernardi  <bernardp@cli.di.unipi.it>
	
	* pathname.d (ensure_directories_exist): Changed arglist from
	  "&optional verbose" to "&key verbose"
	* subr.d: Likewise.
	* subrkw.d: Added entry for ensure_directories_exist.
	* constsym.d: Added the keyword :VERBOSE.
	
1998-05-07  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* aclocal.m4 (CL_RUSAGE): Check for getrusage declaration. Define
	  RUSAGE_WHO_T.
	* unixconf.h.in (RUSAGE_WHO_T): New macro.
	* unix.d (getrusage): Change declaration.
	
1998-05-05  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* aclocal.m4 (CL_DYNLOAD): Check for dlerror declaration.
	* configure.in, unixconf.h.in: CL_DYNLOAD sets DLERROR_CONST.
	* unix.d (dlerror): Use DLERROR_CONST in the declaration.
	
1997-05-01  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* socket.d (create_server_socket): Avoid an EADDRINUSE error in some
	  harmless cases.
	  (setsockopt): Declare.
	
1998-05-01  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* init.lsp: Load amigasock.lsp by default.
	
1998-04-25  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* predtype.d (CLASS-OF): Change so that (class-of (sys::make-anode))
	  returns the class STRUCTURE-OBJECT instead of the class T.
	
1998-04-25  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* modules/bindings/linux/linux.lsp: Make LINUX package case sensitive.
	  (fd_isset): Use lisp:floor, not linux:floor.
	  (EXIT_SUCCESS): Set to 0.
	
1998-04-25  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* compiler.lsp (c-form): Respect NOTINLINE declarations on macros.
	
1998-04-25  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* flo_rest.d (warn_floating_point_contagion): New function.
	  (GEN_F_op2): Warn when floating point contagion occurs.
	* realelem.d (R_R_contagion_R): Likewise.
	* constsym.d (*warn-on-floating-point-contagion*): New variable.
	* lisparit.d (init_arith): Initialize it.
	  (init_arith): Initialize *inhibit-floating-point-underflow* here,
	  not in set_lf_digits().
	* constobj.d (fpcontagion_warn_string): New.
	
1998-04-20  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* makemake.in: Rename bindings/linux to bindings/linuxlibc5.
	* bindings/linuxlibc6: New module.
	
1998-04-18  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>

        * conditio.lsp (floating-point-inexact,
          floating-point-invalid-operation): New classes.
        * init.lsp: Export their names.
        * defs3.lsp: Likewise.

1998-04-18  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* clos.lsp: Export CLOS:METHOD.
	  (method): New structure class.
	  (standard-method): Inherit from it.
	* init.lsp: Export CLOS:METHOD.
	* defs3.lsp: Likewise.
	
1998-04-18  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* predtype.d (TYPE-OF, CLASS-OF): Use CLOS::CLOSCLASS instead of
	  CLOS::CLASS.
	* record.d (fehler_keine_klasse): Use CLOS:CLASS.
	* clos.lsp (find-class, setf find-class, ensure-class): Use
	  CLOS::CLOSCLASS instead of CLOS::CLASS.
	* type.lsp (typep, canonicalize-type, type-expand-1): Likewise.
	* user2.lsp (apropos, describe): Likewise.
	* compiler.lsp (c-TYPEP): Likewise.
	* init.lsp: Export clos:class.
	* defs3.lsp: Likewise.
	
1998-04-18  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* record.d (CLOS::STRUCTURE-OBJECT-P): Renamed from
	  CLOS::STRUCTURE-INSTANCE-P.
	  (COPY-STRUCTURE): Use type STRUCTURE-OBJECT instead of STRUCTURE.
	* io.d (print_structure): Likewise.
	* eval.d: (FUNTAB): Rename CLOS::STRUCTURE-INSTANCE-P to
	  CLOS::STRUCTURE-OBJECT-P.
	* compiler.lsp (funtab, subr-info, c-DIRECT-FUNCTION-CALL): Likewise.
	  (c-typep-alist1): Likewise.
	  (c-typep-alist2): Remove type STRUCTURE.
	* type.lsp (CLOS:STRUCTURE-OBJECT): Rename CLOS::STRUCTURE-INSTANCE-P
	  to CLOS::STRUCTURE-OBJECT-P.
	  (STRUCTURE): Remove builtin type.
	  (subtypep): Remove type STRUCTURE.
	* defstruc.lsp (defstruct): All structure types except STRUCTURE-OBJECT
	  inherit from STRUCTURE-OBJECT.
	  (structure-object): New structure class.
	* constobj.d (class_structure_types): Update accordingly.
	* clos.lsp (<structure-object>): Update initial value.
	  (compute-dispatch): Rename CLOS::STRUCTURE-INSTANCE-P to
	  CLOS::STRUCTURE-OBJECT-P.
	* init.lsp: Export STRUCTURE-OBJECT.
	* defs3.lsp: Likewise.
	
1998-04-18  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* io.d (print_structure): New function, doing the bulk of pr_structure.
	  (pr_structure): Call it.
	  (pr_external_1): Do respect *print-circle*.
	* defstruc.lsp (clos::defstruct-remove-print-object-method): One more
	  hook for CLOS.
	  (defstruct): Implement option :PRINT-OBJECT. Options :PRINT-FUNCTION
	  and :PRINT-OBJECT both cause a PRINT-OBJECT method to be installed.
	* clos.lsp (defstruct-remove-print-object-method): New function.
	  (class, standard-method): Use PRINT-OBJECT methods instead of
	  :PRINT-FUNCTION option.
	  (built-in-class, slotted-class, structure-class, standard-class):
	  Drop :PRINT-FUNCTION option.
	  (print-class, print-std-method): Lose third argument.
	  (initialize-instance structure-class): Drop print-function
	  inheritance hack.
	* init.lsp: CLOS is not optional any more.
	* conditio.lsp (restart): Use :PRINT-OBJECT option instead of
	  :PRINT-FUNCTION option.
	  (print-restart): Lose third argument.
	
1998-04-18  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* defs3.lsp: Don't export *evalhook*, *applyhook*, evalhook, applyhook.
	
1998-04-18  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* constsym.d (set): Rename SET to SYS::SET-SYMBOL-VALUE.
	* places.lsp (SYMBOL-VALUE): Use SYS::SET-SYMBOL-VALUE.
	  SET is a deprecated alias.
	* defs1.lsp (copy-symbol): Use SYS::SET-SYMBOL-VALUE.
	* defs2.lsp (define-symbol-macro): Likewise.
	* affi1.lsp (open-library): Likewise.
	* macros1.lsp (defvar, defparameter): Likewise.
	* compiler.lsp (funtab): Likewise.
	  (subr-info): Add SYS::SET-SYMBOL-VALUE.
	  (*deprecated-functions*): New variable.
	  (note-function-used): New function.
	  (c-GLOBAL-FUNCTION-CALL): Call it.
	  (c-FUNCTION): Call it.
	  (compile-file): Initialize *deprecated-functions*. Warn about the
	  use of deprecated functions.
	
1998-04-18  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* type.lsp (CLOS:GENERIC-FUNCTION): New builtin type.
	  (subtypep): Treat it.
	* compiler.lsp (c-typep-alist1): Treat it.
	* clos.lsp: Export CLOS:GENERIC-FUNCTION.
	  (<generic-function>): New variable, new class CLOS:GENERIC-FUNCTION.
	* init.lsp: Export CLOS:GENERIC-FUNCTION.
	* defs3.lsp: Likewise.
	
1998-04-17  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* constsym.d (copy_structure): Rename SYS::%COPY-STRUCTURE to
	  COPY-STRUCTURE.
	* defstruc.lsp (ds-make-copier): Likewise.
	* compiler.lsp (funtab, subr-info, c-DIRECT-FUNCTION-CALL): Likewise.
	* init.lsp: Export COPY-STRUCTURE.
	* defs3.lsp: Likewise.
	
1998-04-16  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* defmacro.lsp (make-macro-expansion): Change scope of the block to
	  include only the body, not the lambda list.
	* macros2.lsp (deftype): Likewise.
	
1998-04-16  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* debug.d (read_form): Withdraw the clear-input/listen hack, use
	  interactive-stream-p instead. After reading a form, clear input
	  only upto a newline.
	* lispbibl.d (interactive_stream_p): New declaration.
	* user1.lsp (break-loop): Do (clear-input *debug-io*) upon entry
	  of the break loop.
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* type.lsp (type-expand-1, type-expand): New functions.
	* user2.lsp (describe): Give a hint for DEFTYPEd types.
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* type.lsp (CONS): New composite type specifier.
	  (canonicalize-type): Expand NUMBER to (OR REAL COMPLEX).
	  (canonicalize-type): Simplify (AND type), (OR type).
	  (subtypep): If type2 = (OR), replace it by NIL. For numbers, improve
	  the fallback case. Treat the composite CONS type.
	* compiler.lsp (c-typep-alist3): New composite type specifier CONS.
	* type.tst: Replace '(cons symbol) by '(symbol cons).
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* defstruc.lsp (defstruct): Compare slot names using :test #'string=
	  :key #'symbol-name, not :test #'eq.
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* conditio.lsp (arithmetic-error, cell-error, unbound-slot, type-error,
	  package-error, print-not-readable, stream-error, file-error,
	  simple-condition): Use non-exported symbols as slot names.
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* clos.lsp (compute-applicable-methods): Turn into a generic
	  function.
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* compiler.lsp (compile-file): Perform more merge-pathnames
	  operations.
	  (compile-file-pathname): Likewise. Add &allow-other-keys.
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* clos.lsp (analyze-method-description): Allow class objects as
	  parameter specializers.
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* init.lsp: Remove an unnecessary copy of the walker code.
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* control.d (case): New special form.
	* init.lsp (%expand-form): Treat it.
	  (%expand-case): New function.
	* macros1.lsp (case): Put the macro definition on the property list.
	* compiler.lsp (c-CASE): Now a special form handler.
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* array.d (copy_sbvector): New function.
	* lispbibl.d (copy_sbvector): Declare it.
	* record.d (SYS::GENERIC-FUNCTION-EFFECTIVE-METHOD-FUNCTION): New
	  function.
	* compiler.lsp (c-LAMBDABODY): A generic function dispatch code
	  ends with (RETGF) and needs only one value.
	* clos.lsp (analyze-method-description): Add check for
	  CALL-NEXT-METHOD called with arguments.
	  (slow-funcall-gf): Return the effective method, don't call it.
	  (finalize-fast-gf): No need to pass the arguments to
	  initial-funcall-gf.
	  (initial-funcall-gf): Just return the gf, don't apply it to the args.
	  (compute-dispatch): Return the effective method, don't call it.
	  (%call-next-method): New function.
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* bytecode.d (cod_skip_retgf, cod_funcall_skip_retgf): New byte codes.
	  (cod_store8, cod_store9): Remove.
	* eval.d (interpret_bytecode_): Implement the new bytecodes.
	* compiler.lsp (instruction-table): New instructions SKIP&RETGF and
	  FUNCALL&SKIP&RETGF.
	  (short-code-base, short-code-opsize, short-code-ops): Update for
	  removed store8, store9.
	  (traverse-anode): RETGF is like a barrier.
	  (simplify): RETGF needs one value only.
	  (SP-depth): RETGF returns, like RET.
	  (insert-combined-LAPs): Combine SKIP and RETGF. Combine FUNCALL and
	  SKIP and RETGF.
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* constobj.d (version): New bytecode version.
	  (old_version): Remove.
	* misc.d (SYS::VERSION): Drop test for O(old_version).
	* package.d (SYS::OLD-MAKE-PACKAGE, SYS::OLD-%IN-PACKAGE,
	  SYS::OLD-IN-PACKAGE): Remove backward compatibility hacks.
	* subrkw.d (old_make_package, old_pin_package, old_in_package):
	  Likewise.
	* debug.d (SYS::%ROOM): Renamed from SYS::OLD-ROOM.
	* user2.lsp (room): Call it.
	* eval.d (FUNTAB): Replace old_make_package, old_pin_package,
	  old_in_package by the new make_package, pin_package, in_package.
	  Remove old_room.
	* compiler.lsp (funtab): Likewise.
	
1998-04-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* list.d (BUTLAST, NBUTLAST): Signal an error if len==0 and dotted.
	
1998-04-12  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* array.d (ARRAY-DISPLACEMENT): New function.
	* init.lsp, defs3.lsp: Export it.
	
1998-04-11  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* lispbibl.d (conditiontype): New condition types source_program_error
	  and keyword_error.
	* genclisph.d (conditiontype): Likewise.
	* constsym.d (simple-source-program-error, simple-keyword-error):
	  Likewise.
	* error.d (end_error): Treat keyword_error.
	* eval.d (parse_dd, get_closure, eval1, eval_fsubr,
	  fehler_eval_zuwenig, fehler_eval_zuviel, fehler_eval_dotted):
	  Emit source_program_error instead of program_error.
	  (fehler_key_unpaarig, fehler_key_zuviel, funcall_iclosure,
	  fehler_apply_zuviel, fehler_apply_zuwenig): Emit program_error
	  instead of error.
	  (interpret_bytecode_.cod_mvcall): Likewise.
	  (fehler_key_notkw): Emit keyword_error instead of type_error.
	  (fehler_key_badkw): Emit keyword_error instead of error.
	* control.d (fehler_funsymbol, FUNCTION, check_setq_body,
	  fehler_docstring, make_variable_frame, COMPILER-LET, fehler_funspec,
	  MACROLET, COND, RETURN-FROM, TAGBODY, GO, DECLARE, PARSE-BODY):
	  Emit source_program_error instead of program_error.
	  (MULTIPLE-VALUE-CALL, APPLYHOOK): Emit program_error instead of
	  error.
	* foreign.d (FOREIGN-CALL-OUT): Emit program_error instead of error.
	* conditio.lsp (source-program-error, keyword-error,
	  simple-source-program-error, simple-keyword-error): New condition
	  types. Pass them to %defclcs.
	  (define-condition, handler-case, restart-bind, expand-restart-case):
	  Emit source-program-error instead of program-error.
	* clos.lsp (with-slots, with-accessors, defclass,
	  analyze-method-description, defmethod, analyze-defgeneric,
	  analyze-defgeneric-lambdalist, analyze-generic-fundefs):
	  Emit source-program-error instead of program-error.
	  (slow-funcall-gf, do-defgeneric): Emit program-error instead of
	  error.
	* affi1.lsp (mlibcall): Emit source-program-error instead of
	  program-error.
	* defmacro.lsp (macro-call-error, analyze-aux, analyze-rest, analyze1,
	  remove-env-arg, make-macro-expansion): Emit source-program-error
	  instead of program-error.
	* defs2.lsp (defpackage, define-symbol-macro): Emit
	  source-program-error instead of program-error.
	  (check-not-special-variable-p): Emit program-error instead of error.
	* defstruc.lsp (ds-symbol-or-error, defstruct): Emit
	  source-program-error instead of program-error.
	* foreign1.lsp (check-symbol, def-c-var, element, deref, slot, cast,
	  typeof): Emit source-program-error instead of program-error.
	* init.lsp (%the-environment-error, %expand-form, %expand-list,
	  %expand-lambda, %expand-lambdalist, %expand-varspez,
	  %expand-varspez*, %expand-fundefs-1, defun, do): Emit
	  source-program-error instead of program-error.
	* macros1.lsp (defvar, defparameter, defconstant, do/do*-expand,
	  psetq, case, ifify, cond): Emit source-program-error instead of
	  program-error.
	* macros2.lsp (typecase, deftype): Emit source-program-error instead
	  of program-error.
	* macros3.lsp (expand-LETF*, expand-LETF): Emit source-program-error
	  instead of program-error.
	* places.lsp (get-setf-method-multiple-value, get-setf-method,
	  define-setf-method, defsetf, psetf, define-modify-macro, setf,
	  shiftf, setf apply, setf funcall): Emit source-program-error
	  instead of program-error.
	* trace.lsp (trace1, untrace1): Emit source-program-error instead of
	  program-error.
	
1998-04-11  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* constobj.d (type_peektype, type_rexx_host): Use BOOLEAN instead of
	  (MEMBER NIL T).
	* format.lsp (format): Likewise.
	* clx.lsp (boolean): Remove definition.
	
1998-04-10  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* lispbibl.d: Port to powerpc-apple-mklinux.
	  Add a verification for oint_addr_mask.
	
1998-04-10  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* aclocal.m4 (CL_FPU_CONTROL): New macro.
	* configure.in: Call it.
	* unixconf.h.in: New macro HAVE_SETFPUCW.
	* unixaux.d: Set __fpu_control only if __setfpucw() doesn't exist.
	* spvw.d (main): Call __setfpucw() if it exists.
	
1998-04-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* compiler.lsp (EQL=EQ): Don't use fixnump.
	
1998-04-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* init.lsp: Export BOOLEAN.
	* defs3.lsp: Likewise.
	* type.lsp (TYPE-SYMBOL, SUBTYPEP): Treat BOOLEAN.
	* compiler.lsp (*declaration-types*, c-typep-alist2): Likewise.
	* predtype.d (TYPE-OF): (type-of 't) returns BOOLEAN.
	* user2.lsp (describe): Adapt for TYPE-OF change.
	
1998-04-01  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* type.lsp (%the): Instead of typep, use near-typep, which returns T
	  for a read-label.
	
1998-03-24  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* compiler.lsp (var): New slot `for-value-usedp'.
          (c-VAR): Set it.
          (ignore-check): Use it, instead of `usedp'.
          (bind-fixed-var-1, process-fixed-var-list, bind-movable-var,
           c-FLET, c-LABELS, c-GENERIC-FLET, c-GENERIC-LABELS): Initialize it.
	
1998-03-24  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* io.d (princ_up): Bind *PRINT-READABLY* to NIL.
	
1998-03-23  Jörg Höhle  <Joerg.Hoehle@gmd.de>
	
	* compiler.lsp (c-IF): No extra JMP if no else part.
	
1998-03-16  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* pathname.d (OPEN): For the :element-type argument, allow deftype'd
          type specifiers. Check their validity using SUBTYPEP and
          SYS::SUBTYPEP-INTEGER.
	
1998-03-14  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* macros2.lsp (space): Call VALUES-LIST explicitly.
	* user2.lsp (%space): No need to return values.
	
1998-03-14  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* io.d (%DEFIO): New function.
	  (SET-MACRO-CHARACTER): If function is a dispatch-reader function, 
	  unpack it.
	  (GET-MACRO-CHARACTER): For a dispatch macro character, return a
	  dispatch-reader function.
	* defs2.lsp (dispatch-reader): New function. Call %defio.
	
1998-03-12  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* loop.lsp (expand-loop): Emit the REPEAT decrement before its
          end test, not afterwards.
	* loop.tst: A new test.
	
1998-03-11  Pierpaolo Bernardi  <bernardp@cli.di.unipi.it>
	
	* macros2.lsp (etypecase, ctypecase, ecase, ccase): Allow T and
          OTHERWISE as keys, but warn about them unless parenthesized.
	* conditio.lsp (etypecase, ctypecase, ecase, ccase): Likewise.
	
1998-03-10  Sam Steingold  <sds@usa.net>
	
	* io.d: fixed a minor grammatical error.
	
1998-03-07  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* amiga.d (stdin_handle): Renamed from Input_handle.
	  (stdout_handle): Renamed from Output_handle.
	  All references changed.
	* lispbibl.d (strm_file_name, strm_file_truename): Both can be a
	  pathname or NIL.
	* io.d (pr_stream): Don't print strm_file_name if it is NIL.
	* pathname.d (test_file_stream_named): New function.
	  (parse-namestring, truename, probe-file, delete-file, rename-file,
	  open, file-write-date, file-author): Call test_file_stream_named.
	* stream.d (regular_handle_p): Move function outside #if.
	  (b_file_finish_flush): Adapt for unnamed file streams.
	  (fehler_position_beyond_EOF, make_file_stream): Likewise.
	  (b_file_full_flush): Don't call lseek if the stream is write-only.
	  (b_file_half_flush): Likewise.
	  (b_file_nextbyte): Don't read buffer if the stream is write-only.
	  (position_b_file, position_file_end): Likewise.
	  (make_file_stream): Unnamed output stream are write-only.
	  (finish_output_file): For unnamed streams, don't close the handle.
	  (make_terminal_io): New function.
	  (init_streamvars): Call it.
	
1998-03-07  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* stream.d (finish_tty_output, force_tty_output, clear_tty_output):
	  Ignore ENOSYS on Irix (occurs on pipes).
	
1998-02-19  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* spvw.d: Define MULTIMAP_MEMORY_SYMBOL_TAB if
	  MULTIMAP_MEMORY && MAP_MEMORY_TABLES. But don't multimap the subr_tab
	  - wouldn't work in the case of dynamic loading.
	
1998-02-19  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
        Make aktenv a separate entity (will be per-thread later).
	* lispbibl.d (aktenv): Make a global variable.
	* eval.d (aktenv): New global variable.
	* constobj.d (akt_*_env): Remove.
	* spvw.d (for_all_threadobjs): New macro.
	  (gc_markphase, aktualisiere_object_tab): Call it.
	  (initmem): Initialize aktenv.
	
1998-02-19  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* clos.lsp (*dynamically-modifiable-generic-function-names*): New
	  variable.
	  (warn-if-gf-already-called): Don't warn if gf is listed in it.
	
1998-02-19  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* format.lsp (format-parse-cs): Add format directive ~!.
	  (format-call): New function.
	  (formatter-main-1): Compile format-call.
	
1998-02-15  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* lispbibl.d (GNU_GETTEXT): Support gettext with IBMPC_CHS as well.
	  (INIT_SYMBOL_TAB): Don't define for EMUNIX.
	* gettext/intl/Makefile.dos: New file.
	* dos/gtconfig.h: New file.
	* dos/gtobjects: New file.
	* dos/copyx.bat, os2/copyx.cmd: Copy them.
	* spvw.d (to_latin_table, from_latin_table): New arrays.
	  (cvgettext): New function.
	  (clgettext): Call cvgettext, instead of gettext.
	* msdos.d (full_read, full_write): Change declaration to match the
	  definition in unixaux.d.
	  (get_handle_input_status, intdos): Save %ebx in asm calls.
	* stream.d (kbhit, getch, get_handle_info, intvideo): Likewise.
	* makemake.in: Support gettext on DOS, OS/2 platforms with EMX.
	  (EMX): Link with emxl.exe, not emx.exe.
	  Do not strip lisp.exe.
	* dos/convert.bax, os2/convert.bax: Don't convert binary files
	  like *.gif.
	* dos/delx.bat, os2/delx.cmd: Remove more things. Don't descend into
	  src/readline or src/newreadline - these directories may not exist.
	* Makefile.devel (dos--distrib, os2--distrib): Copy lispinit.mem,
	  not compiled.mem. Copy the *.mo files. Copy the translated READMEs.
	  Copy impnotes.html. Copy emx.exe. Copy emxrt.doc.
	
1998-02-15  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* lispbibl.d: Remove support for EMX versions < 0.9c.
	* msdos.d: Likewise.
	  (FILE_PID): Remove definition.
	* spvw.d (alarm_handler, main): Remove support for EMX versions < 0.9c.
	* stream.d (finish_tty_output, force_tty_output, listen_handle,
	  kbhit, getch, clear_window, delete_window_line, init_term): Likewise.
	  (make_pipe_input_stream, make_pipe_output_stream,
	  make_pipe_io_stream): Don't use FILE_PID any more.
	* os2/popenrw.c: Likewise.
	* error.d (begin_error, tast_break): Remove support for EMX
	  versions < 0.9c.
	  * graph.d: Likewise.
	* pathname.d: Likewise.
	* time.d: Likewise.
	
1998-02-15  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* cv-to-ibmpc.c (main): Translate the characters 0xCD and 0xD3 to
	  ASCII, instead of dropping them. Needed for the spanish messages.
	
1998-02-11  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	Remove support for traditional (pre-ANSI-C) compilers. Assume
	<stdlib.h> and <string.h> are present.
	* ansidecl.d: Assume <stdlib.h> is present.
	* txt2c.c: Likewise.
	* ccmp2c.d: Likewise.
	  (new_statement, main): Assume ANSI C declaration syntax.
	* comment5.d (main): Assume ANSI C declaration syntax.
	* dedefined.c: Removed.
	* deelif.d: Removed.
	* deerror.c: Removed.
	* mergestrings.d: Removed.
	* traddecl.d: Removed.
	* lispbibl.d: Assume ANSI C (or C++) compiler.
	  (const, signed, void): Remove conditional definitions.
	  (GENTAG, STRING): Simplify.
	  (DECLTAG, BEGIN_DECLTAG, END_DECLTAG, local_function): Remove.
	  (_ARGS, PARM0, PARM1, PARM2, PARM3, PARM4, PARM5): Remove.
	  (nonreturning_function): Simplify.
	  (signed_int_with_n_bits, unsigned_int_with_n_bits): Unconditional.
	  (sintB, uintB, sintW, uintW, sintL, uintL): Simplify definition.
	  (sintQ, uintQ, sintP, uintP): Likewise.
	  (sintBW, uintBW, sintWL, uintWL, sintBWL, uintBWL): Likewise.
	  (sintD, uintD, sintDD, uintDD, tint, aint, saint, cint): Likewise.
	  (module_): Simplify declaration.
	* genclisph.d (_ARGS): Remove. Assume ANSI C declaration syntax.
	* unix.d (FAULT_HANDLER_ARGDECL): Remove.
	  (FAULT_HANDLER_ARGLIST): Assume ANSI C declaration syntax.
	* io.d: Change `local_function' to `local'.
	* package.d: Likewise.
	* array.d: Likewise.
	* flo_rest.d (GEN_F_op1, GEN_ffloor, GEN_fceiling, GEN_fround,
	  GEN_round, GEN_F_fround, GEN_F_round, GEN_F_F_round): Use ANSI C
	  declaration syntax.
	* realelem.d (GEN_R_round, GEN_R_fround, GEN_R_R_round, GEN_R_R_mod,
	  GEN_R_R_fround): Use ANSI C declaration syntax.
	* realtran.d (GEN_F_atanx, GEN_F_sinx): Use ANSI C declaration syntax.
	* pathname.d (nametype_namestring_parts): Likewise.
	* spvw.d (gc_sweep1_varobject_page): Likewise.
	  (gc_sweep2_varobject_page): Likewise.
	  (sigsegv_handler): Simplify declaration.
	  (dynload_modules): Simplify cast for initfunction1 and initfunction2.
	* avl.d (AVL_map_*): Remove calls to BEGIN_DECLTAG, END_DECLTAG and
	  DECLTAG.
	* _clisp.c (perror, main): Assume ANSI C declaration syntax.
	* ari68020.d (C, clrx): Assume ANSI C preprocessor.
	* ari80386.d (C, L): Likewise.
	* sp80386.d (C): Likewise.
	* arisparc.d (C): Likewise.
	* asmi386.hh (C, L): Likewise.
	* configure.in: Don't call AC_PROG_GCC_TRADITIONAL, CL_CC_NEED_DEELIF,
	  CL_CC_NEED_DEERROR, CL_CC_NEED_MERGESTRINGS any more.
	* makemake.in: Drop support for oldcc. Assume CC_NEED_DEELIF,
	  CC_NEED_DEERROR, CC_NEED_MERGESTRINGS to be false. Assume CC_ANSI
	  to be true. Assume gcc is not used with -traditional. Always use
	  ansidecl, not traddecl.
	
1998-02-11  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* modules/stdwin: Removed.
	* makemake.in (--with-module-stdwin): Remove option.
	* Makefile.devel (SOURCES4): No need any more to exclude stdwin.
	  (CONFIGURES): Remove modules/stdwin/configure.
	  (src--distrib): Don't create clispsrc-stdwin.tar.gz.
	
1998-02-10  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* intsqrt.d (UDS_sqrt_): gcc-2.5.8 on hppa has same problem with
	  isqrt as gcc-2.7.0 on i386. Same workaround works.
	
1998-02-10  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* constobj.d (showstack_string_CALLBACK_frame): Define if
	  HAVE_SAVED_REGISTERS, not HAVE_SAVED_STACK.
	
1998-02-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* spvw.d (gar_col_normal): Unify three occurrences of the same error
	  message. Wrap munmap() calls in begin/end_system_call().
	
1998-02-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	Preliminary support for Mingw32:
	* ansidecl.d, traddecl.d, dedefined.c, ccmp2c.d, txt2c.c: Define
	  STDC_HEADERS if __MINGW32__.
	* lispbibl.d (WIN32): Define if __MINGW32__.
	  (I80386): Define if _X86_ is defined.
	* ari80386.d, sp80386.d, asmi386.hh: The __MINGW32__ assembler has
	  the ELF "align" pseudo-op.
	* win32.d: "#undef unused" before including other header files.
	  (_MAX_PATH): Define to an arbitrary value.
	  (uAsciiChar): New macro, against unnamed union in __MINGW32__.
	  (wProcessorArchitecture): Similarly.
	  (MAXHOSTNAMELEN): Define only unless already defined.
	  (CoGetCurrentProcess): Declare explicitly for __MINGW32__.
	* stream.d (listen_handle, listen_keyboard, rd_ch_keyboard):
	  Use uAsciiChar.
	* makemake.in ($TSYS = win32gcc): Output a Makefile suitable for
	  Mingw32.
	  (PARENT_M, NEXT_M, SRCTOPDIR_M, UTILDIR_M, DOCDIR_M): New variables.
	  Use them in Makefile rules (as opposed to Makefile commands).
	
1998-02-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* pathname.d (init_pathnames): Don't expect that getlogin() sets
	  errno when it fails.
	
1998-02-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* spvw.d (xmprotect): Use OS_errno, not errno. For Win32.
	
1998-02-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* spvw.d (main.banner): Add a copyright line for 1998.
	
1998-02-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* init.lsp: Export `define-symbol-macro'.
	* defs3.lsp: Likewise.
	
1998-02-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* pathname.d (fehler_notdir): New function, extracted from
	  shorter_directory_arg.
	  (directory_exists): New function.
	  (PROBE-DIRECTORY): New function.
	  (shorter_directory): Renamed from shorter_directory_arg. Accept
	  two arguments. Call fehler_notdir. All callers changed.
	  (make_directory): New function, extracted from MAKE-DIR.
	  (MAKE-DIR): Call it.
	  (ENSURE-DIRECTORIES-EXIST): New function.
	* init.lsp: Export `ensure-directories-exist'.
	* defs3.lsp: Likewise.
	
1998-01-23  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* arilev0.d (mulu32 for I80386): Fix a wrong description of the "mull"
	  instruction.
	
1998-01-21  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* asmi386.hh (NUM, ADDR): To prepend a dollar, use $##n. (Some
	  compilers allow dollars in identifiers. Needed for mingw32.)
	
1998-01-19  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* stream.d (clear_tty_output): Avoid error during CLEAR-OUTPUT on
	  pipes on Win32.
	
1998-01-14  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* pathname.d (file_write_date, file_author): file_exists() takes
	  a `object' as argument, not a `const char *'.
	
1998-01-14  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* predtype.d (hs_record): Add const here too, to fix a small problem
	  in 1997-09-28-const.diff.
	
1998-01-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* makemake.in: Add a comment about MODULES to the makefile.
	
1998-01-11  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* spvw.d (mem.heaptype): Use -1 for SUBRs and < -1 for unused
	  typecodes.
	  (main): Initialize mem.heaptype accordingly.
	  (main): prepare_zeromap for subr_tab is now implicit.
	
1997-12-30  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* lispbibl.d (nonreturning_function): Fix comment.
	* win32.d (SetConsoleCtrlHandler): Fix comment.
	
1997-12-13  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* eval.d (unwind): Fix a compilation warning in WIDE mode: don't cast
	  directly from oint to a pointer.
	
1997-12-11  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* lispbibl.d: Write MC680X0 instead of M680X0.
	
1997-12-11  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* spvw.d (make_space_gc*): If zeromap() fails, output an informative
	  message, to calm down users.
	
1997-12-11  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* makemake.in (distrib for acorn): Distribute impnotes.html.
	
1997-12-05  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* sequence.d (valid_type): Recognize (SIMPLE-ARRAY eltype 1) as
	  equivalent of (SIMPLE-ARRAY eltype (*)).
	* type.lsp (subtypep): Likewise.
	
1997-12-01  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* cfglinux.lsp: File removed.
	* FILES.1: Don't mention it.
	* makemake.in: Likewise.
	
1997-11-29  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* ffcall/{trampoline,callback/trampoline_r}/trampoline.c
	  (alloc_trampoline): Add support for NetBSD/m68k.
	* makemake.in: Recognize m68k-netbsd for ari680x0 support.
	
1997-11-15  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* ffcall/callback/Makefile.{in,msvc}: callback.h resides in the
	  build dir, not the source dir.
	* ffcall/callback/callback.h.in: Renamed from callback.h.
	
1997-11-14  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* io.d (prin1a): When *PRINT-PRETTY* = T, there is no need to output
	  a newline if the next string begins with a newline character anyway.
	
1997-11-14  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	Allow dynamic loading of modules, if configured --with-dynamic-modules.
	* clisp-link.in (run): New command.
	* aclocal.m4 (CL_DYNLOAD): New macro.
	* configure.in: Use it.
	* unixconf.h.in (HAVE_DLOPEN): New macro.
	* unix.d: Use it to declare dlopen, dlsym, dlclose, dlerror.
	* makemake.in: New option --with-dynamic-modules.
	* lispbibl.d (STACK_register if I80386): Define only if DYNAMIC_MODULES
	  is not defined.
	  (HAVE_SAVED_REGISTERS if I80386): Likewise.
	  (tagging scheme): Likewise.
	  (modules): Declare.
	  (dynload_modules): Declare.
	* modules.d: Treat DYNAMIC_MODULES.
	* pathname.d (SYS::DYNLOAD-MODULES): New function.
	* spvw.d (init_modules_0): New function.
	  (init_module_2): New function.
	  (init_other_modules_2): Call it.
	  (dynload_modules): New function.
	
1997-11-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* ffcall: Upgrade to ffcall-1.3
	* Makefile.devel (CONFIGURES): Update accordingly.
	* foreign.d (convert_function_to_foreign, free_foreign_callin,
	  convert_function_from_foreign, callback, init_ffi): Use callback
	  package instead of vacall+trampoline.
	
1997-11-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* aclocal.m4 (CL_MACHINE): Force CL_CHAR_UNSIGNED before CL_MACHINE.
	
1997-11-08  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* aclocal.m4 (CL_CANONICAL_HOST_CPU): Support for KAI C++ which
          doesn't like "#undef __i386__" nor "#define __i386__".
	
1997-10-20  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* disassem.lsp (disassemble-machine-code for UNIX): Inhibit line
          breaks, 1 instruction per line, otherwise the instruction gets
          filtered away.
	
1997-10-19  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* conditio.lsp: Conditionalize upon feature ANSI-CL, not dpANS.
	* defs2.lsp, defs3.lsp, init.lsp, loop.lsp: Likewise.
	
1997-10-12  Jörg Höhle  <Joerg.Hoehle@zeus.gmd.de>
	
	* amigasock.lsp: New file.
	
1997-10-08  Jörg Höhle  <Joerg.Hoehle@zeus.gmd.de>
	
	* eval.d (interpret_bytecode (cod_throw)): Tweak message.
	
1997-10-06  Jörg Höhle  <Joerg.Hoehle@zeus.gmd.de>
	
	* cfgamiga.lsp (machine-instance): Prefix with "localhost".
	* erramiga.d (error200_msg_table): Add some translations.

1997-09-30  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* utils/gcc-cccp/Makefile.msvc: Set stack size for cccp.exe.
	* asmi386.sh: For the sake of msvc5, which assembles relative
          addresses in an unpredictable way, turn jump tables into absolute,
          not relative, addresses.
	
1997-09-28  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* charstrg.d (copy_string, NSTRING-UPCASE, NSTRING-DOWNCASE,
	  NSTRING-CAPITALIZE): Make reentrant and multithread-safe.
	
1997-09-28  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
        Stack overflow robustness on Win32:
	* lispbibl.d (NO_SP_CHECK, NOCOST_SP_CHECK): New macros. SP checks
          are enabled if AMIGAOS || (WIN32_NATIVE && !CAN_HANDLE_WP_FAULT).
	* spvw.d (do_gar_col_simple, do_gar_col): If WIN32_NATIVE &&
          CAN_HANDLE_WP_FAULT, check for stack overflow just before GC,
          because a stack overflow during GC would be unrecoverable.
	* spvw.d (subst_circ_mark, stack_overflow_handler,
          main_exception_filter): Put in the right #ifdefs.
	* spvw.d (stack_overflow_stack): New variable.
          (main): Set it.
	
1997-09-28  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* lispbibl.d (map_heap_function): Renamed from mapper_function.
          (map_heap_objects): Change declaration.
	* spvw.d (map_heap_objects): Likewise.
	
1997-09-28  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* array.d (initial_contents_locals): New structure.
          (initial_contents_aux): Make reentrant and multithread-safe.
	* lispbibl.d (map_sequence): Declare.
	* sequence.d (map_sequence): New function.
	
1997-09-28  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* spvw.d (everything_ready): Remove unused variable.
	
1997-09-28  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* Use `const' qualifier when possible, especially on constant arrays.
          This allows constant arrays to be put into the rodata section.
	* arilev1c.d (copy_loop_up, copy_loop_down, or_loop_up, xor_loop_up,
          and_loop_up, eqv_loop_up, nand_loop_up, nor_loop_up, andc2_loop_up,
          orc2_loop_up, and_test_loop_up, test_loop_up, compare_loop_up,
          add_loop_down, addto_loop_down, sub_loop_down, subx_loop_down,
          subfrom_loop_down, shiftleftcopy_loop_down, shiftrightcopy_loop_up,
          mulu_loop_down, muluadd_loop_down, mulusub_loop_down,
          divucopy_loop_up): Use `const'.
	* arilev1e.d (copy_loop_up, copy_loop_down, or_loop_up, xor_loop_up,
          and_loop_up, eqv_loop_up, nand_loop_up, nor_loop_up, andc2_loop_up,
          orc2_loop_up, and_test_loop_up, test_loop_up, compare_loop_up,
          add_loop_down, addto_loop_down, sub_loop_down, subx_loop_down,
          subfrom_loop_down, shiftleftcopy_loop_down, shiftrightcopy_loop_up,
          mulu_loop_down, muluadd_loop_down, mulusub_loop_down,
          divucopy_loop_up): Use `const'.
	* arilev1i.d (copy_loop_up, copy_loop_down, or_loop_up, xor_loop_up,
          and_loop_up, eqv_loop_up, nand_loop_up, nor_loop_up, andc2_loop_up,
          orc2_loop_up, and_test_loop_up, test_loop_up, compare_loop_up,
          add_loop_down, addto_loop_down, sub_loop_down, subx_loop_down,
          subfrom_loop_down, shiftleftcopy_loop_down, shiftrightcopy_loop_up,
          mulu_loop_down, muluadd_loop_down, mulusub_loop_down,
          divucopy_loop_up): Use `const'.
	* array.d (type_table): Use `const'.
	* charstrg.d (up_case_table, down_case_table, charname_table_codes,
          char_name, name_char): Use `const'.
	* control.d (fsubr_tab): Use `const'.
	* debug.d (frame_up_table, frame_down_table, test_mode_arg): Use
          `const'.
	* eval.d (FUNTAB, FUNTABR, cod_labels): Use `const'.
	* graph.d (EGA_colors, gr_colors, g320x200x16_regs, g320x200x16_info,
          g640x200x16_regs, g640x200x16_info, g640x350x16_regs,
          g640x350x16_info, g640x480x16_regs, g640x480x16_info,
          g320x200x256_regs, g320x200x256_info, g320x240x256_regs,
          g320x240x256_info, g320x400x256_regs, g320x400x256_info,
          g360x480x256_regs, g360x480x256_info, g640x480x2_regs,
          g640x480x2_info, g640x480x256_regs, g640x480x256_info,
          g800x600x256_regs, g800x600x256_info, g1024x768x256_regs,
          g1024x768x256_info, default_red, default_green, default_blue,
          color16, et4000_set_regs, set_regs, mono_colors, EGA_colors,
          VGA_colors, gr_colors, font, gr_text, GRAPH-INIT): Use `const'.
	* hashtabl.d (tuple_half_1, tuple_half_2): Use `const'.
	* intmal.d (mulu_2loop_down, mulu_2bigloop_down, fakul_table): Use
          `const'.
	* intprint.d (table, UDS_to_DIGITS): Use `const'.
	* io.d (orig_syntax_table, orig_readtable, SET-READTABLE-CASE,
          attribute_table, char_reader, pr_character, pr_stream): Use `const'.
	* lisparit.d (pi_mantisse, ln2_mantisse, ln10_mantisse): Use `const'.
	* lispbibl.d (fsubr_tab): Use `const'.
	* predtype.d (init_hs_locals_rest): Use `const'.
	* realrand.d (multiplier): Use `const'.
	* sequence.d (test_start_end, test_start_end_1): Use `const'.
	* spvw.d (pname_table, package_index_table, init_symbol_tab_2,
          fsubr_data_tab, object_initstring_tab, features_initstring,
          init_object_tab, banner, banner2, banner3, main,
          loadmem_aktualisiere, copyright_notice): Use `const'.
	
1997-09-27  Bruno Haible  <bruno@linuix.mathematik.uni-karlsruhe.de>
	
	* acspecific.m4 (AC_FUNC_VFORK): Fix so that it works right when
	  cross-compiling.
